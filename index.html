<script>
async function logVisitor() {
  const userAgent = navigator.userAgent;
  const language = navigator.language;
  const screenSize = `${screen.width}x${screen.height}`;
  const windowSize = `${window.innerWidth}x${window.innerHeight}`;
  const referrer = document.referrer || '';
  const url = location.href;
  const platform = navigator.platform;
  const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
  const localTime = new Date().toString();
  const date = new Date().toISOString();
  const isMobile = /Mobi|Android|iPhone|iPad/i.test(userAgent) ? 'Mobile' : 'Desktop';
  const darkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  const cookieEnabled = navigator.cookieEnabled;
  const cores = navigator.hardwareConcurrency || 'unknown';
  const ram = navigator.deviceMemory || 'unknown';
  const online = navigator.onLine;
  const colorDepth = screen.colorDepth || 'unknown';
  const connection = navigator.connection ? navigator.connection.effectiveType : 'unknown';
  const touchSupport = 'ontouchstart' in window;

  // Battery
  let batteryLevel = 'unsupported';
  try {
    const battery = await navigator.getBattery();
    batteryLevel = Math.round(battery.level * 100) + '%';
  } catch (e) {}

  // Browser detection
  let browser = 'Unknown';
  if (userAgent.includes("Chrome") && !userAgent.includes("Edge")) browser = 'Chrome';
  else if (userAgent.includes("Safari") && !userAgent.includes("Chrome")) browser = 'Safari';
  else if (userAgent.includes("Firefox")) browser = 'Firefox';
  else if (userAgent.includes("Edg")) browser = 'Edge';
  else if (userAgent.includes("OPR") || userAgent.includes("Opera")) browser = 'Opera';

  // IP
  let ip = 'unknown';
  try {
    const res = await fetch('https://api.ipify.org?format=json');
    const json = await res.json();
    ip = json.ip;
  } catch (e) {}

  const data = {
    ip,
    date,
    localTime,
    language,
    platform,
    browser,
    deviceType: isMobile,
    screenSize,
    windowSize,
    colorDepth,
    referrer,
    url,
    timezone,
    batteryLevel,
    darkMode,
    cookieEnabled,
    connection,
    touchSupport,
    online,
    hardwareCores: cores,
    ramGB: ram,
    userAgent
  };

  try {
    await fetch('https://webhook.site/4e5facef-8227-498e-9970-31d80913e906', {
      method: 'POST',
      body: JSON.stringify(data),
      headers: { 'Content-Type': 'application/json' }
    });
  } catch (e) {
    console.error('Log failed', e);
  }
}

logVisitor();
</script>
